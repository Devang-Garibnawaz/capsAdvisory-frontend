"use strict";(self.webpackChunktred_code_portal=self.webpackChunktred_code_portal||[]).push([[695],{20695:(e,r,t)=>{t.r(r),t.d(r,{default:()=>se});var o=t(65043),a=t(86971),s=t(49760),n=t(81683),l=t(96866),i=t(69120),d=t(66360),c=t(57779),u=t(63471),x=t(21337),p=t(85473),h=t(10039),m=t(40632),g=t(58093),b=t(17392),A=t(85865),j=t(53404),f=t(19042),C=t(81637),y=t(15795),v=t(51787),k=t(79650),w=t(63336),E=t(71806),F=t(84882),S=t(28076),T=t(73460),I=t(12110),D=t(53193),B=t(72221),N=t(40818),L=t(77739),z=t(90035),M=t(4219),P=t(35316),O=t(29347),q=t(74802),R=t(70579);const W=e=>{let{open:r,onClose:t,onSubmit:a,brokerAccounts:s}=e;const[n,l]=(0,o.useState)("");return(0,R.jsxs)(z.A,{open:r,onClose:t,maxWidth:"sm",fullWidth:!0,PaperProps:{style:{backgroundColor:"#1E1E1E",color:"#FFFFFF"}},children:[(0,R.jsx)(M.A,{children:(0,R.jsxs)(m.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,R.jsx)(A.A,{variant:"h6",children:"Create New Group"}),(0,R.jsx)(b.A,{onClick:t,size:"small",sx:{color:"white"},children:(0,R.jsx)(q.A,{})})]})}),(0,R.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a({name:n,members:[]}),l("")},children:[(0,R.jsx)(P.A,{children:(0,R.jsx)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:(0,R.jsx)(y.A,{label:"Group Name",value:n,onChange:e=>l(e.target.value),fullWidth:!0,required:!0,sx:{input:{color:"white"},label:{color:"grey.500"},"& .MuiOutlinedInput-root":{backgroundColor:"#2D2D2D","& fieldset":{borderColor:"rgba(255, 255, 255, 0.23)"}}}})})}),(0,R.jsxs)(O.A,{sx:{padding:3},children:[(0,R.jsx)(j.A,{onClick:t,variant:"contained",color:"error",sx:{textTransform:"none"},children:"Cancel"}),(0,R.jsx)(j.A,{type:"submit",variant:"contained",color:"primary",sx:{textTransform:"none"},children:"Create Group"})]})]})]})};var $=t(34562),U=t(47260),Y=t(8212),G=t(36363),J=t(51425),Q=t(14161);const V=(0,J.$)();async function _(){try{const e=await(0,Q.q)(),r=await fetch(`${V}groups/getGroups`,{method:"GET",headers:e});return await r.json()}catch(e){throw console.log("Error fetching groups:",e),new Error("Failed to fetch groups")}}var H=t(56587),X=t(79190);const Z=e=>{let{open:r,onClose:t,onSubmit:a,brokerAccounts:s,excludeAccountIds:n=[]}=e;const[l,i]=(0,o.useState)(""),[d,c]=(0,o.useState)("1"),[u,x]=(0,o.useState)(!1);(0,o.useEffect)((()=>{r||(i(""),c("1"),x(!1))}),[r]);const p=()=>{i(""),c("1"),x(!1),t()},h=s.filter((e=>!n.includes(e.id)));return(0,R.jsxs)(z.A,{open:r,onClose:p,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:e=>"dark"===e.palette.mode?"#1E1E1E":"#FFFFFF",color:e=>"dark"===e.palette.mode?"#FFFFFF":"#1E293B"}},children:[(0,R.jsx)(M.A,{children:(0,R.jsxs)(m.A,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[(0,R.jsx)(A.A,{variant:"h6",sx:{color:e=>"dark"===e.palette.mode?"#FFFFFF":"#1E293B"},children:"Add Child Account"}),(0,R.jsx)(b.A,{onClick:p,size:"small",sx:{color:e=>"dark"===e.palette.mode?"white":"#64748B"},children:(0,R.jsx)(q.A,{})})]})}),(0,R.jsx)(P.A,{children:(0,R.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a({accountId:l,multiplier:parseFloat(d),fixLot:u}),p()},children:[(0,R.jsxs)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{id:"select-child-label",sx:{color:e=>"dark"===e.palette.mode?"grey.500":"#64748B"},children:"Select Child"}),(0,R.jsx)(B.A,{labelId:"select-child-label",value:l,onChange:e=>i(e.target.value),required:!0,sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",backgroundColor:e=>"dark"===e.palette.mode?"#2D2D2D":"#F8FAFC","& .MuiOutlinedInput-notchedOutline":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.23)":"rgba(0, 0, 0, 0.23)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.4)"},"& .MuiSelect-icon":{color:e=>"dark"===e.palette.mode?"white":"#64748B"}},children:h.map((e=>(0,R.jsx)(N.A,{value:e.id,children:e.name},e.id)))})]}),(0,R.jsx)(y.A,{label:"Multiplier",type:"number",value:d,onChange:e=>c(e.target.value),fullWidth:!0,required:!0,inputProps:{min:"0.1",step:"0.1"},sx:{input:{color:e=>"dark"===e.palette.mode?"white":"#1E293B"},label:{color:e=>"dark"===e.palette.mode?"grey.500":"#64748B"},"& .MuiOutlinedInput-root":{backgroundColor:e=>"dark"===e.palette.mode?"#2D2D2D":"#F8FAFC","& fieldset":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.23)":"rgba(0, 0, 0, 0.23)"},"&:hover fieldset":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.4)"}}}}),(0,R.jsx)(j.A,{variant:"contained",color:u?"primary":"inherit",onClick:()=>x(!u),type:"button",sx:{backgroundColor:e=>{if(!u)return"dark"===e.palette.mode?"#2D2D2D":"#F1F5F9"},color:e=>u||"dark"===e.palette.mode?"white":"#1E293B","&:hover":{backgroundColor:e=>{if(!u)return"dark"===e.palette.mode?"#374151":"#E2E8F0"}}},children:"Fix Lot"})]}),(0,R.jsxs)(O.A,{sx:{padding:3},children:[(0,R.jsx)(j.A,{onClick:p,variant:"contained",color:"error",type:"button",sx:{textTransform:"none"},children:"Cancel"}),(0,R.jsx)(j.A,{type:"submit",variant:"contained",color:"primary",disabled:!l,sx:{textTransform:"none"},children:"Add"})]})]})})]})};var K=t(34185),ee=t(68903),re=t(64664),te=t(49935);const oe=e=>{let{group:r,open:t,onClose:a}=e;const[s,n]=(0,o.useState)("NIFTY"),[l,i]=(0,o.useState)(""),[d,c]=(0,o.useState)(""),[u,x]=(0,o.useState)("INTRADAY"),[p,h]=(0,o.useState)(75),[m,g]=(0,o.useState)("Market"),[b,A]=(0,o.useState)(0),[f,v]=(0,o.useState)(0),[k,w]=(0,o.useState)("BUY"),[E,F]=(0,o.useState)([]),[S,T]=(0,o.useState)(!1),I=(0,$.dh)(),L=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";T(!0);const r=await(0,H.au)(e||s);if(!r||!r.data||!r.data.optionsData)return I.error("No Stikeprice Found!"),T(!1),n("NIFTY"),void a();const t=W(r.data.optionsData);F(t),T(!1)};function q(e){const[r,t,o]=e.split("-"),a=o.slice(-2);return`${r}${{Jan:"JAN",Feb:"FEB",Mar:"MAR",Apr:"APR",May:"MAY",Jun:"JUN",Jul:"JUL",Aug:"AUG",Sep:"SEP",Oct:"OCT",Nov:"NOV",Dec:"DEC"}[t]}${a}`}(0,o.useEffect)((()=>{t&&L()}),[t]);const W=e=>{const r=[];return e.forEach((e=>{const t=e.strikePrice;if(e.CE){const o=q(e.CE.expiryDate);r.push(`NIFTY${o}${t}CE`)}if(e.PE){const o=q(e.PE.expiryDate);r.push(`NIFTY${o}${t}PE`)}})),r};return(0,R.jsxs)(z.A,{open:t,onClose:a,fullWidth:!0,maxWidth:"md",children:[(0,R.jsx)(M.A,{children:"Place Order"}),(0,R.jsx)(P.A,{children:S?(0,R.jsx)(C.A,{}):(0,R.jsxs)(ee.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{children:"Index"}),(0,R.jsx)(B.A,{value:s,label:"Index",onChange:e=>{const r=e.target.value;i(""),c(""),n(r),L(r)},children:(0,R.jsx)(N.A,{value:"NIFTY",children:"NIFTY"})})]})}),(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{children:"Script Type"}),(0,R.jsxs)(B.A,{value:l,label:"Script Type",onChange:e=>{const r=e.target.value;c(""),i(r)},children:[(0,R.jsx)(N.A,{value:"",children:"Select Script Type"}),(0,R.jsx)(N.A,{value:"CE",children:"CE"}),(0,R.jsx)(N.A,{value:"PE",children:"PE"})]})]})}),(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{children:"Script"}),(0,R.jsxs)(B.A,{value:d,label:"Script",disabled:!l,onChange:e=>c(e.target.value),children:[(0,R.jsx)(N.A,{value:"",selected:!0,children:"Select Script"}),E.filter((e=>e.includes(l))).map((e=>(0,R.jsx)(N.A,{value:e,children:e},e)))]})]})}),(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{children:"Product"}),(0,R.jsxs)(B.A,{value:u,label:"Product",onChange:e=>x(e.target.value),children:[(0,R.jsx)(N.A,{value:"INTRADAY",children:"INTRADAY"}),(0,R.jsx)(N.A,{value:"CARRYFORWARD",children:"CARRYFORWARD"}),(0,R.jsx)(N.A,{value:"DELIVERY",children:"DELIVERY"})]})]})}),(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{children:"Quantity"}),(0,R.jsxs)(B.A,{value:p,label:"Quantity",onChange:e=>h(Number(e.target.value)),children:[(0,R.jsx)(N.A,{value:"75",children:"1"},"75"),(0,R.jsx)(N.A,{value:"150",children:"2"},"150"),(0,R.jsx)(N.A,{value:"225",children:"3"},"225"),(0,R.jsx)(N.A,{value:"300",children:"4"},"300"),(0,R.jsx)(N.A,{value:"375",children:"5"},"375")]})]})}),(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(D.A,{fullWidth:!0,children:[(0,R.jsx)(X.A,{children:"Order Type"}),(0,R.jsxs)(B.A,{value:m,label:"Order Type",onChange:e=>g(e.target.value),children:[(0,R.jsx)(N.A,{value:"Market",children:"Market"}),(0,R.jsx)(N.A,{value:"Limit",children:"Limit"}),(0,R.jsx)(N.A,{value:"SL",children:"SL"})]})]})}),("LIMIT"===m.toUpperCase()||"SL"===m.toUpperCase())&&(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsx)(D.A,{fullWidth:!0,children:(0,R.jsx)(y.A,{value:b,label:"Limit Price",type:"Number",onChange:e=>A(Number(e.target.value))})})}),"SL"===m.toUpperCase()&&(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsx)(D.A,{fullWidth:!0,children:(0,R.jsx)(y.A,{value:f,label:"Trigger Price",type:"Number",onChange:e=>v(Number(e.target.value))})})}),(0,R.jsx)(ee.Ay,{item:!0,xs:12,sm:4,children:(0,R.jsxs)(re.A,{value:k,exclusive:!0,onChange:(e,r)=>r&&w(r),fullWidth:!0,children:[(0,R.jsx)(te.A,{value:"BUY",color:"success",sx:{"&.Mui-selected":{backgroundColor:"green",color:"white","&:hover":{backgroundColor:"#006400"}}},children:"BUY"}),(0,R.jsx)(te.A,{value:"SELL",color:"error",sx:{"&.Mui-selected":{backgroundColor:"#EF4444",color:"white","&:hover":{backgroundColor:"#8B0000"}}},children:"SELL"})]})})]})}),(0,R.jsxs)(O.A,{sx:{px:3,pb:2},children:[(0,R.jsx)(j.A,{variant:"contained",color:"error",onClick:a,children:"Close"}),(0,R.jsx)(j.A,{variant:"contained",color:"primary",onClick:async()=>{if(!d)return void I.warning("Please select script!");if(("LIMIT"===m.toUpperCase()||"SL"===m.toUpperCase())&&(!b||b<=0))return void I.warning("Please enter limit price!");if("SL"===m.toUpperCase()&&(!f||f<=0))return void I.warning("Please enter trigger price!");const e={index:s,scriptType:l,script:d,product:u,quantity:p,orderType:m,orderAction:k,groupId:r.id};"LIMIT"!==m.toUpperCase()&&"SL"!==m.toUpperCase()||(e.limitPrice=b),"SL"===m.toUpperCase()&&(e.triggerPrice=f);try{const r=await async function(e){try{const r=await fetch(`${V}orders/placeMannualOrder`,{method:"POST",headers:await(0,Q.q)(),body:JSON.stringify(e)});return await r.json()}catch(r){throw new Error("Failed to place mannual order: "+r)}}(e);r.status?I.success("Order placed!"):I.error("Order not placed: "+r.message)}catch(t){I.error("Error occured: "+t)}a()},children:"Place Order"})]})]})},ae=e=>{let{group:r,onBack:t,onAddChild:s,onToggleMaster:n,onToggleTrading:l,isTogglingMaster:u,isTogglingTrading:I,masterAccountName:D,setRefreshFunction:B,brokerAccounts:N,setBrokerAccounts:L}=e;const[z,M]=(0,o.useState)(!1),[P,O]=(0,o.useState)([]),[q,W]=(0,o.useState)(!1),[U,Y]=(0,o.useState)(null),[G,J]=(0,o.useState)({activeTab:"positions",searchQuery:"",orderBy:"",order:"asc"}),[_,X]=(0,o.useState)({positions:[],orders:[],trades:[]}),Z=(0,$.dh)(),ee=(0,a.Zp)(),re=(0,o.useRef)(null),[te,ae]=(0,o.useState)(!1),se=async()=>{try{W(!0);const e=await async function(e){try{const r=await(0,Q.q)(),t=await fetch(`${V}groups/getChildren/${e}`,{method:"GET",headers:r});return await t.json()}catch(r){throw console.log("Error fetching group children:",r),new Error("Failed to fetch group children")}}(r.id);if(e.status){const r=e.dematAccounts.map((e=>({id:e.id,name:`${e.fullName}-angelone-${e.clientId}`,accountId:e.id,status:e.isTradeEnable?"active":"inactive",multiplier:e.multiplier||1,fixLot:e.fixLot||!1,stats:e.stats})));O(r)}}catch(e){console.error("Error fetching group children:",e.message)}finally{W(!1)}};(0,o.useEffect)((()=>{se()}),[r.id]),(0,o.useEffect)((()=>{const e=[],r=[],t=[];P.forEach((o=>{var a,s,n,l;null!==(a=o.stats)&&void 0!==a&&a.position&&e.push(...Object.values(o.stats.position)),null!==(s=o.stats)&&void 0!==s&&null!==(n=s.orders)&&void 0!==n&&n.orders&&r.push(...Object.values(o.stats.orders.orders)),null!==(l=o.stats)&&void 0!==l&&l.trades&&t.push(...Object.values(o.stats.trades))})),X({positions:e,orders:r,trades:t})}),[P]),(0,o.useEffect)((()=>{const e=localStorage.getItem("authkey");return re.current&&re.current.close(),re.current=new WebSocket(`ws://localhost:8080/ws/demat?token=${e}&group=${r.id}`),re.current&&(re.current.onopen=()=>console.log("Connected"),re.current.onmessage=e=>{const r=JSON.parse(e.data);if("demat_accounts"===r.type){var t;const e=null===r||void 0===r||null===(t=r.data)||void 0===t?void 0:t.dematAccounts.map((e=>({id:e.id,name:`${e.fullName}-angelone-${e.clientId}`,accountId:e.id,status:e.isTradeEnable?"active":"inactive",multiplier:e.multiplier||1,fixLot:e.fixLot||!1,stats:e.stats})));O(e)}},re.current.onclose=()=>console.log("Disconnected")),()=>{re.current&&re.current.close()}}),[]);const ne=async e=>{try{const t=await async function(e,r){try{const t=await(0,Q.q)(),o=await fetch(`${V}groups/removeChild`,{method:"POST",headers:{...t,"Content-Type":"application/json"},body:JSON.stringify({groupId:e,accountId:r})});return await o.json()}catch(t){throw console.log("Error removing child from group:",t),new Error("Failed to remove child from group")}}(r.id,e);t.status?(O((r=>r.filter((r=>r.accountId!==e)))),Z.success("Child account removed from group successfully")):Z.error(t.message||"Failed to remove child from group")}catch(t){Z.error("Error removing child from group: "+t.message)}},le=async e=>{try{const r=await async function(e){try{const r=await fetch(`${V}groups/squareOffAll/${e}`,{method:"POST",headers:await(0,Q.q)()});return await r.json()}catch(r){throw console.log("Error square off all by group:",r),new Error("Failed to square off all by group")}}(e);r.status?(Z.success(r.message),se()):Z.error(r.message||"Failed to square off all")}catch(r){Z.error("Error square off all: "+r.message)}},ie=e=>{J({...G,activeTab:e})},de=()=>{const{activeTab:e,searchQuery:r,orderBy:t,order:o}=G;let a=_[e];if(r){const e=r.toLowerCase();a=a.filter((r=>Object.values(r).some((r=>String(r).toLowerCase().includes(e)))))}return"positions"===e&&(a=a.map((e=>({...e,netqty:Number(e.netqty)||0,avgnetprice:parseFloat(e.avgnetprice)||0})))),t?a=[...a].sort(((e,r)=>{let a=e[t],s=r[t];return"string"!==typeof a||isNaN(Number(a))||(a=Number(a),s=Number(s)),"exchtime"!==t&&"filltime"!==t||(a=new Date(a).getTime(),s=new Date(s).getTime()),"desc"===o?s>a?1:s<a?-1:0:a>s?1:a<s?-1:0})):"positions"===e?a=[...a].sort(((e,r)=>{const t=0!==Number(e.netqty),o=0!==Number(r.netqty);return t&&!o?-1:!t&&o?1:Math.abs(Number(r.netqty)||0)-Math.abs(Number(e.netqty)||0)})):"orders"!==e&&"trades"!==e||(a=[...a].sort(((r,t)=>{const o=new Date("orders"===e?r.exchtime:r.filltime).getTime();return new Date("orders"===e?t.exchtime:t.filltime).getTime()-o}))),a},ce=e=>{let{label:r,field:t}=e;return(0,R.jsx)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",padding:"8px",backgroundColor:e=>"dark"===e.palette.mode?"#1A1C1E":"#F8FAFC",position:"sticky",top:0,zIndex:1,borderBottom:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)",cursor:"pointer"},onClick:()=>(e=>{const r=G.orderBy===e&&"asc"===G.order;J({...G,order:r?"desc":"asc",orderBy:e})})(t),children:(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[r,(0,R.jsx)(g.A,{active:G.orderBy===t,direction:G.orderBy===t?G.order:"asc",sx:{"& .MuiTableSortLabel-icon":{color:e=>"dark"===e.palette.mode?"white !important":"#1E293B !important"},"&.Mui-active":{color:e=>"dark"===e.palette.mode?"white !important":"#1E293B !important"},color:e=>"dark"===e.palette.mode?"white !important":"#1E293B !important"}})]})})};return(0,R.jsxs)(m.A,{children:[(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1.5,backgroundColor:e=>"dark"===e.palette.mode?"#1A1C1E":"#ffffff",p:1.5,borderRadius:1,boxShadow:1},children:[(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,R.jsx)(b.A,{onClick:t,size:"small",sx:{backgroundColor:"#0EA5E9","&:hover":{backgroundColor:"#0284C7"},padding:"6px"},children:(0,R.jsx)(i.A,{sx:{color:"white",fontSize:"1.2rem"}})}),(0,R.jsx)(A.A,{variant:"subtitle1",sx:{color:e=>"dark"===e.palette.mode?"white":"text.primary",fontWeight:500},children:r.name}),(0,R.jsx)(j.A,{variant:"contained",onClick:()=>{B(se),s()},size:"small",sx:{backgroundColor:"#0EA5E9","&:hover":{backgroundColor:"#0284C7"},py:.5,px:1.5,textTransform:"none",fontSize:"0.875rem"},children:"+ Add Child"}),(0,R.jsx)(j.A,{variant:"contained",color:"success",size:"small",onClick:()=>{M(!0)},sx:{py:.5,px:1.5,textTransform:"none",fontSize:"0.875rem"},children:"Place Order"})]}),(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[(0,R.jsx)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:D&&(0,R.jsxs)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"white":"text.primary"},children:[(0,R.jsx)("span",{style:{fontWeight:"bold",fontSize:"0.8rem",color:"#0EA5E9"},children:"Master Account:"})," ",D]})}),(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"grey.500":"text.secondary"},children:"Trading"}),(0,R.jsx)(f.A,{checked:r.isTradeEnabled,onChange:l,disabled:I,size:"small",sx:{"& .MuiSwitch-thumb":{backgroundColor:r.isTradeEnabled?"#22C55E !important":"#DC2626 !important"},"& .MuiSwitch-track":{backgroundColor:r.isTradeEnabled?"#22C55E !important":"#DC2626 !important"}}}),(0,R.jsxs)(A.A,{variant:"subtitle2",sx:{color:_.positions.reduce(((e,r)=>e+(Number(r.pnl)||0)),0)>=0?"#22C55E":"#EF4444",ml:1.5},children:["PNL: ",_.positions.reduce(((e,r)=>e+(Number(r.pnl)||0)),0).toFixed(2)]}),(0,R.jsx)(b.A,{onClick:se,size:"small",sx:{backgroundColor:"#8B5CF6","&:hover":{backgroundColor:"#7C3AED"},padding:"6px"},children:(0,R.jsx)(c.A,{sx:{color:"white",fontSize:"1.2rem"}})})]})]}),(0,R.jsx)(m.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:q?(0,R.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,R.jsx)(C.A,{})}):P.length>0?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,cursor:"pointer",backgroundColor:e=>"dark"===e.palette.mode?"#1A1C1E":"#FFFFFF",padding:"12px 16px",borderRadius:"8px",border:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease","&:hover":{backgroundColor:e=>"dark"===e.palette.mode?"#262626":"#F8FAFC",borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"}},onClick:()=>ae(!te),children:[(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[te?(0,R.jsx)(p.A,{sx:{fontSize:"1.5rem",color:e=>"dark"===e.palette.mode?"#60A5FA":"#2563EB"}}):(0,R.jsx)(x.A,{sx:{fontSize:"1.5rem",color:e=>"dark"===e.palette.mode?"#60A5FA":"#2563EB"}}),(0,R.jsxs)(A.A,{variant:"subtitle1",sx:{fontWeight:500,color:e=>"dark"===e.palette.mode?"white":"#1E293B",fontSize:"0.95rem"},children:[te?"Collapse":"Expand"," Broker Cards"]})]}),(0,R.jsxs)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#94A3B8":"#64748B",backgroundColor:e=>"dark"===e.palette.mode?"#27272A":"#F1F5F9",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem"},children:[P.length," ",1===P.length?"Card":"Cards"]})]}),(0,R.jsx)(m.A,{sx:{display:te?"grid":"none",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:3,mt:2,animation:te?"fadeIn 0.3s ease-in-out":"none","@keyframes fadeIn":{"0%":{opacity:0,transform:"translateY(-10px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:P.map((e=>(0,R.jsx)(K.A,{name:e.name,margin:0,isTrading:"active"===e.status,stats:e.stats,onToggleTrading:()=>(async e=>{try{Y(e);const r=P.find((r=>r.accountId===e));if(!r)return;const t=await(0,H.CM)(e,"active"!==r.status);t.status?(O((r=>r.map((r=>r.accountId===e?{...r,status:"active"===r.status?"inactive":"active"}:r)))),Z.success(`Trading ${"active"!==r.status?"enabled":"disabled"} successfully`)):Z.error(t.message||"Failed to update trading status")}catch(r){Z.error("Error toggling trading status: "+r.message)}finally{Y(null)}})(e.accountId),onRefresh:()=>(async()=>{await se()})(),onDelete:()=>ne(e.accountId),onView:()=>{return r=e.accountId,void ee(`/admin/account/${r}`);var r},isToggling:U===e.accountId,isActionButtonVisible:e.accountId!==r.masterAccountId},e.id)))}),(0,R.jsxs)(m.A,{sx:{display:"flex",backgroundColor:e=>"dark"===e.palette.mode?"#1A1C1E":"#F8FAFC",borderRadius:1,mb:1,mt:1,overflow:"hidden",border:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)"},children:[(0,R.jsx)(j.A,{variant:"positions"===G.activeTab?"contained":"text",onClick:()=>ie("positions"),sx:{flex:1,py:1.5,borderRadius:0,backgroundColor:e=>"positions"===G.activeTab?"dark"===e.palette.mode?"#000":"#3b82f6":"transparent",color:e=>"positions"===G.activeTab?"white":"dark"===e.palette.mode?"grey.500":"#64748B","&:hover":{backgroundColor:e=>"positions"===G.activeTab?"dark"===e.palette.mode?"#000":"#3b82f6":"dark"===e.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},children:"Positions"}),(0,R.jsx)(j.A,{variant:"orders"===G.activeTab?"contained":"text",onClick:()=>ie("orders"),sx:{flex:1,py:1.5,borderRadius:0,backgroundColor:e=>"orders"===G.activeTab?"dark"===e.palette.mode?"#000":"#3b82f6":"transparent",color:e=>"orders"===G.activeTab?"white":"dark"===e.palette.mode?"grey.500":"#64748B","&:hover":{backgroundColor:e=>"orders"===G.activeTab?"dark"===e.palette.mode?"#000":"#3b82f6":"dark"===e.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},children:"Orders"}),(0,R.jsx)(j.A,{variant:"trades"===G.activeTab?"contained":"text",onClick:()=>ie("trades"),sx:{flex:1,py:1.5,borderRadius:0,backgroundColor:e=>"trades"===G.activeTab?"dark"===e.palette.mode?"#000":"#3b82f6":"transparent",color:e=>"trades"===G.activeTab?"white":"dark"===e.palette.mode?"grey.500":"#64748B","&:hover":{backgroundColor:e=>"trades"===G.activeTab?"dark"===e.palette.mode?"#000":"#3b82f6":"dark"===e.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}},children:"Trades"})]}),(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start",mb:1,gap:2},children:[(0,R.jsx)(y.A,{placeholder:"Search...",value:G.searchQuery,onChange:e=>{J({...G,searchQuery:e.target.value})},size:"small",sx:{backgroundColor:e=>"dark"===e.palette.mode?"#1A1C1E":"#F8FAFC",borderRadius:1,minWidth:"240px","& .MuiOutlinedInput-root":{color:e=>"dark"===e.palette.mode?"white":"#1E293B","& fieldset":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.23)":"rgba(0, 0, 0, 0.23)"},"&:hover fieldset":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.5)":"rgba(0, 0, 0, 0.5)"}}},InputProps:{startAdornment:(0,R.jsx)(v.A,{position:"start",children:(0,R.jsx)(d.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#64748B"}})})}}),"positions"===G.activeTab&&(0,R.jsx)(j.A,{variant:"contained",color:"error",size:"medium",onClick:()=>le(r.id),disabled:!_.positions.some((e=>0!==Number(e.netqty))),sx:{py:.7,px:2,textTransform:"none",minWidth:"100px",backgroundColor:e=>"dark"===e.palette.mode?"#DC2626":"#EF4444","&:hover":{backgroundColor:e=>"dark"===e.palette.mode?"#B91C1C":"#DC2626"}},children:"Exit All"}),"orders"===G.activeTab&&(0,R.jsx)(j.A,{variant:"contained",color:"error",size:"medium",onClick:()=>async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{const r=_.orders.filter((e=>{var r;return!["complete","rejected","cancelled"].includes(null===(r=e.status)||void 0===r?void 0:r.toLowerCase())})).map((e=>e.orderid)),t=await(0,H.F8)(e,r);t.status?(Z.success(t.message),se()):Z.error(t.message||"Failed to cancel orders")}catch(r){Z.error("Error cancelling orders: "+r.message)}}(r.id),disabled:!_.orders.some((e=>!["complete","cancelled","rejected"].includes(e.status.toLowerCase()))),sx:{py:.7,px:2,textTransform:"none",minWidth:"100px",backgroundColor:e=>"dark"===e.palette.mode?"#DC2626":"#EF4444","&:hover":{backgroundColor:e=>"dark"===e.palette.mode?"#B91C1C":"#DC2626"}},children:"Cancel All"})]}),(0,R.jsx)(k.A,{component:w.A,sx:{backgroundColor:e=>"dark"===e.palette.mode?"rgba(26, 28, 30, 0.5)":"rgba(255, 255, 255, 0.9)",maxHeight:"600px",position:"relative",overflow:"auto",margin:"16px 0",borderRadius:"8px","& .MuiTableRow-root:hover":{backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.05) !important":"rgba(0, 0, 0, 0.04) !important"},border:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)"},children:(0,R.jsxs)(E.A,{size:"medium",stickyHeader:!0,children:[(0,R.jsx)(F.A,{children:(0,R.jsxs)(S.A,{children:[("positions"===G.activeTab||"orders"===G.activeTab)&&(0,R.jsx)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",padding:"12px 8px",backgroundColor:e=>"dark"===e.palette.mode?"rgba(26, 28, 30, 0.95)":"rgba(255, 255, 255, 0.95)",position:"sticky",top:0,zIndex:1,borderBottom:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)",fontSize:"0.875rem",fontWeight:700},children:"positions"===G.activeTab?"Exit":"orders"===G.activeTab?"Cancel":""}),(0,R.jsx)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",padding:"12px 8px",backgroundColor:e=>"dark"===e.palette.mode?"rgba(26, 28, 30, 0.95)":"rgba(255, 255, 255, 0.95)",position:"sticky",top:0,zIndex:1,borderBottom:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)",fontSize:"0.875rem",fontWeight:700},children:"Client ID"}),"positions"===G.activeTab&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ce,{label:"Symbol",field:"tradingsymbol"}),(0,R.jsx)(ce,{label:"Product",field:"producttype"}),(0,R.jsx)(ce,{label:"Action",field:"action"}),(0,R.jsx)(ce,{label:"Net Qty",field:"netqty"}),(0,R.jsx)(ce,{label:"P&L",field:"pnl"}),(0,R.jsx)(ce,{label:"LTP",field:"ltp"}),(0,R.jsx)(ce,{label:"Avg Price",field:"avgnetprice"})]}),"orders"===G.activeTab&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ce,{label:"Symbol",field:"tradingsymbol"}),(0,R.jsx)(ce,{label:"Type",field:"transactiontype"}),(0,R.jsx)(ce,{label:"Status",field:"status"}),(0,R.jsx)(ce,{label:"Quantity",field:"quantity"}),(0,R.jsx)(ce,{label:"Price",field:"price"}),(0,R.jsx)(ce,{label:"Time",field:"exchtime"})]}),"trades"===G.activeTab&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ce,{label:"Symbol",field:"tradingsymbol"}),(0,R.jsx)(ce,{label:"Type",field:"transactiontype"}),(0,R.jsx)(ce,{label:"Quantity",field:"fillsize"}),(0,R.jsx)(ce,{label:"Price",field:"fillprice"}),(0,R.jsx)(ce,{label:"Order ID",field:"orderid"}),(0,R.jsx)(ce,{label:"Time",field:"filltime"})]})]})}),(0,R.jsxs)(T.A,{children:[de().map(((e,r)=>{var t,o,a,s,n,l,i,d,c,u,x,p,g,b,f,C,y,v,k,w,E;return(0,R.jsxs)(S.A,{hover:!0,sx:{"&:nth-of-type(odd)":{backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)"},"&:last-child td":{borderBottom:0}},children:[("positions"===G.activeTab||"orders"===G.activeTab)&&(0,R.jsx)(h.A,{sx:{padding:"8px 12px"},children:(0,R.jsxs)(m.A,{sx:{display:"flex",gap:1},children:["positions"===G.activeTab&&(0,R.jsx)(j.A,{variant:"contained",color:"error",size:"small",disabled:0===Number(e.netqty),onClick:()=>(async e=>{try{const r=await(0,H.Vw)(e);r.status?Z.success(r.message):Z.error(r.message||"Failed to square off")}catch(r){Z.error("Error square off: "+r.message)}})(e),sx:{minWidth:"60px",padding:"2px 8px",fontSize:"0.75rem"},children:"Exit"}),"orders"===G.activeTab&&(0,R.jsx)(j.A,{variant:"contained",color:"error",size:"small",onClick:()=>(async e=>{try{const r=await(0,H.TD)(e);r.status?Z.success(r.message):Z.error(r.message)}catch(r){console.error("Error cancelling order:",r),Z.error("Failed to cancel order")}})(e.orderid),disabled:["complete","cancelled","rejected"].includes(e.status.toLowerCase()),sx:{minWidth:"60px",padding:"2px 8px",fontSize:"0.75rem"},children:"Cancel"})]})}),(0,R.jsx)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.9)":"rgba(0, 0, 0, 0.9)",padding:"8px 12px",borderBottom:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.05)":"1px solid rgba(0, 0, 0, 0.05)"},children:e.clientId||"-"}),"positions"===G.activeTab&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",padding:"8px"},children:e.tradingsymbol}),(0,R.jsx)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",padding:"8px"},children:e.producttype}),(0,R.jsx)(h.A,{sx:{padding:"8px"},children:(0,R.jsx)(m.A,{sx:{color:0===Number(e.netqty)?"#fc424a":Number(e.netqty)>0?"#00d25b":"#fc424a",backgroundColor:0===Number(e.netqty)?"rgba(252, 66, 74, 0.2)":Number(e.netqty)>0?"rgba(0, 210, 91, 0.2)":"rgba(252, 66, 74, 0.2)",display:"inline-block",px:1,py:.25,borderRadius:1,textShadow:r=>"dark"===r.palette.mode?0===Number(e.netqty)?"0 0 10px rgba(252, 66, 74, 0.5)":Number(e.netqty)>0?"0 0 10px rgba(0, 210, 91, 0.5)":"0 0 10px rgba(252, 66, 74, 0.5)":"none",fontWeight:500,fontSize:"0.75rem"},children:0===Number(e.netqty)?"CLOSED":Number(e.netqty)>0?"BUY":"SELL"})}),(0,R.jsxs)(h.A,{sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",padding:"8px"},children:[Math.abs(Number(e.netqty)||0),Number(e.cfbuyqty)>0&&(0,R.jsxs)(A.A,{component:"span",sx:{fontSize:"0.7rem",color:e=>"dark"===e.palette.mode?"#9CA3AF":"#64748B",ml:1},children:["(CF: ",e.cfbuyqty,")"]})]}),(0,R.jsxs)(h.A,{sx:{color:Number(e.pnl)>=0?"#22C55E":"#EF4444",padding:"8px"},children:[Number(e.pnl).toFixed(2)," ",Number(e.pnl)<0?"\u2193":"\u2191",0!==Number(e.unrealisedpnl||0)&&(0,R.jsxs)(A.A,{component:"span",sx:{fontSize:"0.7rem",color:Number(e.unrealisedpnl)>=0?"#22C55E":"#EF4444",ml:1},children:["(Unr: ",Number(e.unrealisedpnl).toFixed(2),")"]})]}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:Number(e.ltp).toFixed(2)}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.avgnetprice.toFixed(2)})]}),"orders"===G.activeTab&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.tradingsymbol}),(0,R.jsx)(h.A,{sx:{padding:"8px"},children:(0,R.jsx)(m.A,{sx:{color:"buy"===(null===(t=e.transactiontype)||void 0===t?void 0:t.toLowerCase())?"#00d25b":"#fc424a",backgroundColor:"buy"===(null===(o=e.transactiontype)||void 0===o?void 0:o.toLowerCase())?"rgba(0, 210, 91, 0.2)":"rgba(252, 66, 74, 0.2)",display:"inline-block",px:1,py:.25,borderRadius:1,textShadow:"buy"===(null===(a=e.transactiontype)||void 0===a?void 0:a.toLowerCase())?"0 0 10px rgba(0, 210, 91, 0.5)":"0 0 10px rgba(252, 66, 74, 0.5)",fontWeight:500,fontSize:"0.75rem"},children:null===(s=e.transactiontype)||void 0===s?void 0:s.toUpperCase()})}),(0,R.jsx)(h.A,{sx:{padding:"8px"},children:(0,R.jsx)(m.A,{sx:{color:"complete"===(null===(n=e.status)||void 0===n?void 0:n.toLowerCase())?"#00d25b":"cancelled"===(null===(l=e.status)||void 0===l?void 0:l.toLowerCase())||"rejected"===(null===(i=e.status)||void 0===i?void 0:i.toLowerCase())?"#fc424a":"pending"===(null===(d=e.status)||void 0===d?void 0:d.toLowerCase())?"#fcd34d":"#00d25b",backgroundColor:"complete"===(null===(c=e.status)||void 0===c?void 0:c.toLowerCase())?"rgba(0, 210, 91, 0.2)":"cancelled"===(null===(u=e.status)||void 0===u?void 0:u.toLowerCase())||"rejected"===(null===(x=e.status)||void 0===x?void 0:x.toLowerCase())?"rgba(252, 66, 74, 0.2)":"pending"===(null===(p=e.status)||void 0===p?void 0:p.toLowerCase())?"rgba(252, 211, 77, 0.2)":"rgba(0, 210, 91, 0.2)",display:"inline-block",px:1,py:.25,borderRadius:1,textShadow:"complete"===(null===(g=e.status)||void 0===g?void 0:g.toLowerCase())?"0 0 10px rgba(0, 210, 91, 0.5)":"cancelled"===(null===(b=e.status)||void 0===b?void 0:b.toLowerCase())||"rejected"===(null===(f=e.status)||void 0===f?void 0:f.toLowerCase())?"0 0 10px rgba(252, 66, 74, 0.5)":"pending"===(null===(C=e.status)||void 0===C?void 0:C.toLowerCase())?"0 0 10px rgba(252, 211, 77, 0.5)":"0 0 10px rgba(0, 210, 91, 0.5)",fontWeight:500,fontSize:"0.75rem"},children:null===(y=e.status)||void 0===y?void 0:y.toUpperCase()})}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.quantity}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.price}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.exchtime})]}),"trades"===G.activeTab&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.tradingsymbol}),(0,R.jsx)(h.A,{sx:{padding:"8px"},children:(0,R.jsx)(m.A,{sx:{color:"buy"===(null===(v=e.transactiontype)||void 0===v?void 0:v.toLowerCase())?"#00d25b":"#fc424a",backgroundColor:"buy"===(null===(k=e.transactiontype)||void 0===k?void 0:k.toLowerCase())?"rgba(0, 210, 91, 0.2)":"rgba(252, 66, 74, 0.2)",display:"inline-block",px:1,py:.25,borderRadius:1,textShadow:"buy"===(null===(w=e.transactiontype)||void 0===w?void 0:w.toLowerCase())?"0 0 10px rgba(0, 210, 91, 0.5)":"0 0 10px rgba(252, 66, 74, 0.5)",fontWeight:500,fontSize:"0.75rem"},children:null===(E=e.transactiontype)||void 0===E?void 0:E.toUpperCase()})}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.fillsize}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.fillprice}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.orderid}),(0,R.jsx)(h.A,{sx:{color:"white",padding:"8px"},children:e.filltime})]})]},r)})),0===de().length&&(0,R.jsx)(S.A,{children:(0,R.jsx)(h.A,{colSpan:"trades"===G.activeTab?6:9,align:"center",sx:{color:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.7)":"rgba(0, 0, 0, 0.7)",padding:"24px 8px"},children:G.searchQuery?"No matching records found":"No records found"})})]})]})})]}):(0,R.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:(0,R.jsx)(A.A,{color:"text.secondary",children:"No child accounts connected yet."})})}),(0,R.jsx)(oe,{group:r,open:z,onClose:()=>{M(!1)}})]})},se=()=>{var e;const[r,t]=(0,o.useState)(!1),[a,i]=(0,o.useState)([]),[d,c]=(0,o.useState)([]),[x,p]=(0,o.useState)(!1),[h,g]=(0,o.useState)(!1),[y,v]=(0,o.useState)({}),[k,w]=(0,o.useState)(null),[E,F]=(0,o.useState)(null),[S,T]=(0,o.useState)(!1),[q,J]=(0,o.useState)(!1),[X,K]=(0,o.useState)(null),[ee,re]=(0,o.useState)(null),[te,oe]=(0,o.useState)(!1),[se,ne]=(0,o.useState)(!1),[le,ie]=(0,o.useState)(),[de,ce]=(0,o.useState)(null),ue=(0,$.dh)(),xe=async()=>{try{p(!0);const[e,r]=await Promise.all([(0,H.CX)(),_()]);if(e.status){const r=e.dematAccounts.map((e=>({id:e.id,name:`${e.fullName}-angelone-${e.clientId}`})));c(r)}r.status&&i(r.groups)}catch(e){console.error("Error fetching data:",e)}finally{p(!1)}};(0,o.useEffect)((()=>{xe()}),[]);const pe=()=>{t(!1)},he=async e=>{const r=a.find((r=>r.id===e));if(!r)return;const t=r.selectedAccountId||r.masterAccountId;t&&(r.masterAccountId===t?K({groupId:e,accountId:t,action:"disconnect"}):K({groupId:e,accountId:t,action:"connect"}),T(!0))},me=async e=>{try{F(e);const r=a.find((r=>r.id===e));if(!r)return;const t=await async function(e){try{const r=await(0,Q.q)(),t=await fetch(`${V}groups/toggleTrading`,{method:"PUT",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(r){throw console.log("Error toggling trading status:",r),new Error("Failed to toggle trading status")}}({groupId:e,isTrading:!r.isTradeEnabled});t.status?(ue.success(`Trading ${r.isTradeEnabled?"disabled":"enabled"} successfully`),xe()):ue.error(t.message||"Failed to update trading status")}catch(r){ue.error("Error updating trading status: "+r.message)}finally{F(null)}};return(0,R.jsxs)(o.Fragment,{children:[(0,R.jsx)(s.A,{children:(0,R.jsx)(n.A,{title:"Group Manager"})}),(0,R.jsx)(m.A,{sx:{p:3},children:te&&ee?(0,R.jsx)(ae,{group:a.find((e=>e.id===ee.id)),onBack:()=>{oe(!1),re(null)},onAddChild:()=>ne(!0),onToggleMaster:()=>he(ee.id),onToggleTrading:()=>me(ee.id),isTogglingMaster:k===ee.id,isTogglingTrading:E===ee.id,masterAccountName:null===(e=d.find((e=>e.id===ee.masterAccountId)))||void 0===e?void 0:e.name,setRefreshFunction:e=>ie((()=>e)),brokerAccounts:d,setBrokerAccounts:c}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(m.A,{sx:{mb:3,display:"flex",gap:2},children:(0,R.jsx)(j.A,{component:"label",variant:"contained",tabIndex:-1,startIcon:(0,R.jsx)(l.A,{}),onClick:()=>{t(!0)},disabled:x||h,sx:{py:.5,px:1.5,textTransform:"none",fontSize:"0.875rem"},children:"Create Group"})}),x?(0,R.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,R.jsx)(C.A,{})}):(0,R.jsx)(m.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:3},children:a.length>0?a.map((e=>{var r,t,o,s,n,l,c,x;y[e.id];return(0,R.jsxs)(I.A,{sx:{backgroundColor:e=>"dark"===e.palette.mode?"#1A1C1E":"#FFFFFF",borderRadius:1,p:2,boxShadow:e=>"dark"===e.palette.mode?"0 4px 6px -1px rgba(0, 0, 0, 0.3)":"0 4px 6px -1px rgba(0, 0, 0, 0.1)",border:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)"},children:[(0,R.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,R.jsx)(A.A,{variant:"h6",sx:{color:e=>"dark"===e.palette.mode?"white":"#1E293B",flex:1},children:e.name}),(0,R.jsxs)(m.A,{sx:{display:"flex",gap:1},children:[(0,R.jsx)(b.A,{size:"small",sx:{backgroundColor:e=>"dark"===e.palette.mode?"#3B82F6":"#2563EB","&:hover":{backgroundColor:e=>"dark"===e.palette.mode?"#2563EB":"#1D4ED8"}},onClick:()=>(e=>{const r=a.find((r=>r.id===e));r&&(re({id:e,name:r.name,masterAccountId:r.masterAccountId}),oe(!0))})(e.id),children:(0,R.jsx)(U.A,{fontSize:"small",sx:{color:"white"}})}),(0,R.jsx)(b.A,{size:"small",sx:{backgroundColor:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626","&:hover":{backgroundColor:e=>"dark"===e.palette.mode?"#DC2626":"#B91C1C"}},onClick:()=>(async e=>{ce(e),J(!0)})(e.id),children:(0,R.jsx)(u.A,{fontSize:"small",sx:{color:"white"}})})]})]}),(0,R.jsxs)(m.A,{sx:{mb:2},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#6B7280":"#64748B",mb:1},children:"Master Account"}),(0,R.jsxs)(m.A,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.masterAccountId?(0,R.jsx)(A.A,{sx:{flex:1,color:e=>"dark"===e.palette.mode?"white":"#1E293B",backgroundColor:e=>"dark"===e.palette.mode?"#2D2D2D":"#F1F5F9",padding:"8.5px 14px",borderRadius:1,fontSize:"0.9375rem"},children:(null===(r=d.find((r=>r.id===e.masterAccountId)))||void 0===r?void 0:r.name)||"Connected User"}):(0,R.jsx)(D.A,{fullWidth:!0,size:"small",children:(0,R.jsxs)(B.A,{value:e.selectedAccountId||"",onChange:r=>((e,r)=>{const t=a.find((r=>r.id===e));t&&(t.selectedAccountId=r,i([...a]))})(e.id,r.target.value),displayEmpty:!0,sx:{backgroundColor:e=>"dark"===e.palette.mode?"#2D2D2D":"#F1F5F9",color:e=>"dark"===e.palette.mode?"white":"#1E293B","& .MuiOutlinedInput-notchedOutline":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.23)":"rgba(0, 0, 0, 0.23)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.4)":"rgba(0, 0, 0, 0.4)"}},children:[(0,R.jsx)(N.A,{value:"",disabled:!0,children:"Select Master"}),d.map((e=>(0,R.jsx)(N.A,{value:e.id,children:e.name},e.id)))]})}),(0,R.jsx)(b.A,{size:"small",onClick:()=>he(e.id),disabled:k===e.id||!e.masterAccountId&&!e.selectedAccountId,sx:{backgroundColor:e.masterAccountId?e=>"dark"===e.palette.mode?"#EF4444":"#DC2626":e.selectedAccountId?e=>"dark"===e.palette.mode?"#22C55E":"#16A34A":e=>"dark"===e.palette.mode?"#2D2D2D":"#E2E8F0","&:hover":{backgroundColor:e.masterAccountId?e=>"dark"===e.palette.mode?"#DC2626":"#B91C1C":e.selectedAccountId?e=>"dark"===e.palette.mode?"#16A34A":"#15803D":e=>"dark"===e.palette.mode?"#1F2937":"#CBD5E1"},"&.Mui-disabled":{backgroundColor:e=>"dark"===e.palette.mode?"#2D2D2D":"#E2E8F0"}},children:k===e.id?(0,R.jsx)(C.A,{size:24,sx:{color:"white"}}):e.masterAccountId?(0,R.jsx)(Y.A,{sx:{color:"white"}}):(0,R.jsx)(G.A,{sx:{color:"white"}})})]})]}),(0,R.jsxs)(m.A,{sx:{display:"flex",justifyContent:"flex-end",mb:2},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#6B7280":"#64748B",mr:1},children:"Trading"}),(0,R.jsx)(f.A,{checked:e.isTradeEnabled,onChange:()=>me(e.id),disabled:E===e.id,sx:{"& .MuiSwitch-track":{backgroundColor:e=>"dark"===e.palette.mode?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"},"& .Mui-checked + .MuiSwitch-track":{backgroundColor:e=>"dark"===e.palette.mode?"#22C55E !important":"#16A34A !important"},".MuiSwitch-thumb":{"& .Mui-checked":{backgroundColor:e=>"dark"===e.palette.mode?"#4ADE80 !important":"#22C55E !important"},backgroundColor:e.isTradeEnabled?"#22C55E !important":"#DC2626 !important"}}})]}),(0,R.jsx)(m.A,{sx:{mb:2},children:(0,R.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,R.jsxs)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#6B7280":"#64748B"},children:["Orders ",(null===(t=e.stats)||void 0===t?void 0:t.orders)||0]}),(0,R.jsxs)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#6B7280":"#64748B"},children:["Qty ",(null===(o=e.stats)||void 0===o?void 0:o.qty)||0]})]})}),(0,R.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",borderTop:e=>"dark"===e.palette.mode?"1px solid rgba(255, 255, 255, 0.1)":"1px solid rgba(0, 0, 0, 0.1)",pt:2},children:[(0,R.jsx)(L.A,{title:"Pending",children:(0,R.jsxs)(m.A,{sx:{textAlign:"center"},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#FCD34D":"#D97706"},children:"P"}),(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#FCD34D":"#D97706"},children:(null===(s=e.stats)||void 0===s?void 0:s.pending)||0})]})}),(0,R.jsx)(L.A,{title:"Completed",children:(0,R.jsxs)(m.A,{sx:{textAlign:"center"},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#34D399":"#059669"},children:"C"}),(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#34D399":"#059669"},children:(null===(n=e.stats)||void 0===n?void 0:n.completed)||0})]})}),(0,R.jsx)(L.A,{title:"Rejected",children:(0,R.jsxs)(m.A,{sx:{textAlign:"center"},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626"},children:"R"}),(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626"},children:(null===(l=e.stats)||void 0===l?void 0:l.rejected)||0})]})}),(0,R.jsx)(L.A,{title:"Cancelled",children:(0,R.jsxs)(m.A,{sx:{textAlign:"center"},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626"},children:"C"}),(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626"},children:(null===(c=e.stats)||void 0===c?void 0:c.cancelled)||0})]})}),(0,R.jsx)(L.A,{title:"Failed",children:(0,R.jsxs)(m.A,{sx:{textAlign:"center"},children:[(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626"},children:"F"}),(0,R.jsx)(A.A,{variant:"body2",sx:{color:e=>"dark"===e.palette.mode?"#EF4444":"#DC2626"},children:(null===(x=e.stats)||void 0===x?void 0:x.failed)||0})]})})]})]},e.id)})):(0,R.jsx)(m.A,{sx:{gridColumn:"1 / -1",textAlign:"center",mt:4},children:(0,R.jsx)(A.A,{variant:"h6",color:"text.secondary",children:"No groups found. Create a group to get started."})})})]})}),(0,R.jsx)(W,{open:r,onClose:pe,onSubmit:async e=>{try{g(!0);const r=await async function(e){try{const r=await(0,Q.q)(),t=await fetch(`${V}groups/createGroup`,{method:"POST",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(r){throw console.log("Error creating group:",r),new Error("Failed to create group")}}({name:e.name,members:[]});r.status?(ue.success("Group created successfully"),xe(),pe()):ue.error(r.message||"Failed to create group")}catch(r){ue.error("Error creating group: "+r.message)}finally{g(!1)}},brokerAccounts:d}),(0,R.jsx)(Z,{open:se,onClose:()=>{ne(!1),ie(void 0)},onSubmit:async e=>{try{if(!ee)return;const r=await async function(e,r){try{const t=await(0,Q.q)(),o=await fetch(`${V}groups/addChild`,{method:"POST",headers:{...t,"Content-Type":"application/json"},body:JSON.stringify({groupId:e,...r})});return await o.json()}catch(t){throw console.log("Error adding child to group:",t),new Error("Failed to add child to group")}}(ee.id,e);r.status?(ue.success("Child account added successfully"),le&&await le()):ue.error(r.message||"Failed to add child account")}catch(r){ue.error("Error adding child account: "+r.message)}finally{ne(!1),ie(void 0)}},brokerAccounts:d,excludeAccountIds:[(null===ee||void 0===ee?void 0:ee.masterAccountId)||""]}),(0,R.jsxs)(z.A,{open:S,onClose:()=>{T(!1),K(null)},PaperProps:{style:{backgroundColor:"#1E1E1E",color:"#FFFFFF"}},children:[(0,R.jsx)(M.A,{children:"connect"===(null===X||void 0===X?void 0:X.action)?"Connect Master Account":"Disconnect Master Account"}),(0,R.jsx)(P.A,{children:(0,R.jsx)(A.A,{children:"connect"===(null===X||void 0===X?void 0:X.action)?"Are you sure you want to make this user as master user?":"Are you sure you want to disconnect this master user?"})}),(0,R.jsxs)(O.A,{sx:{padding:2},children:[(0,R.jsx)(j.A,{onClick:()=>{T(!1),K(null)},variant:"contained",color:"error",children:"Cancel"}),(0,R.jsx)(j.A,{onClick:async()=>{if(X)try{w(X.accountId);const e=await async function(e){try{const r=await(0,Q.q)(),t=await fetch(`${V}groups/toggleMaster`,{method:"PUT",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(r){throw console.log("Error toggling master status:",r),new Error("Failed to toggle master status")}}({groupId:X.groupId,accountId:"connect"===X.action?X.accountId:""});e.status?(ue.success("connect"===X.action?"Master account connected successfully":"Master account disconnected successfully"),xe()):ue.error(e.message||"Failed to update master account")}catch(e){ue.error("Error updating master account: "+e.message)}finally{w(null),T(!1),K(null)}},variant:"contained",color:"primary",children:"Confirm"})]})]}),(0,R.jsxs)(z.A,{open:q,onClose:()=>{J(!1),ce(null)},PaperProps:{style:{backgroundColor:"#1E1E1E",color:"#FFFFFF"}},children:[(0,R.jsx)(M.A,{children:"Delete Group"}),(0,R.jsx)(P.A,{children:(0,R.jsx)(A.A,{children:"Are you sure you want to delete this group?"})}),(0,R.jsxs)(O.A,{sx:{padding:2},children:[(0,R.jsx)(j.A,{onClick:()=>{J(!1),ce(null)},variant:"contained",color:"error",children:"Cancel"}),(0,R.jsx)(j.A,{onClick:async()=>{if(de)try{g(!0);const e=await async function(e){try{const r=await(0,Q.q)(),t=await fetch(`${V}groups/deleteGroup`,{method:"DELETE",headers:{...r,"Content-Type":"application/json"},body:JSON.stringify({groupId:e})});return await t.json()}catch(r){throw console.log("Error deleting group:",r),new Error("Failed to delete group")}}(de);e.status?(ue.success("Group deleted successfully"),xe()):ue.error(e.message||"Failed to delete group")}catch(e){ue.error("Error deleting group: "+e.message)}finally{g(!1),J(!1),ce(null)}},variant:"contained",color:"primary",disabled:h,children:h?(0,R.jsx)(C.A,{size:24}):"Delete"})]})]})]})}},34185:(e,r,t)=>{t.d(r,{A:()=>A});t(65043);var o=t(26240),a=t(40632),s=t(85865),n=t(12110),l=t(81637),i=t(19042),d=t(74600),c=t(17392),u=t(68903),x=t(48625),p=t(63471),h=t(47260),m=t(95540),g=t(70579);const b=e=>{let{label:r,value:t}=e;const n=(0,o.A)();return(0,g.jsxs)(a.A,{sx:{textAlign:"center"},children:[(0,g.jsx)(s.A,{variant:"body2",sx:{color:"dark"===n.palette.mode?"#6B7280":"#64748B"},children:r}),(0,g.jsx)(s.A,{variant:"h6",sx:{color:"dark"===n.palette.mode?"white":"#1E293B",mt:1},children:t})]})},A=e=>{var r,t,A,j,f,C;let{name:y,margin:v,isTrading:k,stats:w,onToggleTrading:E,onRefresh:F,onDelete:S,onView:T,onUpdateQuantity:I,isToggling:D=!1,isActionButtonVisible:B=!0}=e;const N=(0,o.A)();return(0,g.jsxs)(n.A,{sx:{backgroundColor:"dark"===N.palette.mode?"#1A1C1E":"#FFFFFF",borderRadius:1,p:2,boxShadow:"dark"===N.palette.mode?"0 4px 6px -1px rgba(0, 0, 0, 0.5)":"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},children:[(0,g.jsx)(a.A,{sx:{display:"flex",alignItems:"center",mb:2},children:(0,g.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",flex:1},children:[(0,g.jsx)(a.A,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:k?"#22C55E":"#DC2626",mr:2}}),(0,g.jsx)(s.A,{variant:"subtitle1",sx:{color:"dark"===N.palette.mode?"#9CA3AF":"#64748B",flex:1},children:y}),(0,g.jsxs)(s.A,{variant:"subtitle1",sx:{color:"dark"===N.palette.mode?"white":"#1E293B",ml:1},children:["Margin ",w.margin]})]})}),(0,g.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,g.jsx)(s.A,{sx:{color:"dark"===N.palette.mode?"#6B7280":"#64748B",mr:1},children:"Trading"}),D?(0,g.jsx)(l.A,{size:24,sx:{color:k?"#22C55E":"#DC2626"}}):(0,g.jsx)(i.A,{checked:k,onChange:E,sx:{"& .MuiSwitch-thumb":{backgroundColor:k?"#22C55E":"#DC2626"},"& .MuiSwitch-track":{backgroundColor:k?"#22C55E !important":"#DC2626 !important"}}}),(0,g.jsx)(a.A,{sx:{flex:1}}),B?(0,g.jsxs)(d.A,{direction:"row",spacing:1,children:[(0,g.jsx)(c.A,{size:"small",sx:{backgroundColor:"#706d6d","&:hover":{backgroundColor:"#3e3e3e"}},onClick:I,children:(0,g.jsx)(m.A,{fontSize:"small",sx:{color:"white"}})}),(0,g.jsx)(c.A,{size:"small",sx:{backgroundColor:"#DC2626","&:hover":{backgroundColor:"#B91C1C"}},onClick:S,children:(0,g.jsx)(p.A,{fontSize:"small",sx:{color:"white"}})}),(0,g.jsx)(c.A,{size:"small",sx:{backgroundColor:"#F59E0B","&:hover":{backgroundColor:"#D97706"}},onClick:F,children:(0,g.jsx)(x.A,{fontSize:"small",sx:{color:"white"}})}),(0,g.jsx)(c.A,{size:"small",sx:{backgroundColor:"#3B82F6","&:hover":{backgroundColor:"#2563EB"}},onClick:T,children:(0,g.jsx)(h.A,{fontSize:"small",sx:{color:"white"}})})]}):(0,g.jsx)(s.A,{variant:"h5",sx:{color:"#0EA5E9",fontWeight:600},children:" Master Account"})]}),(0,g.jsxs)(u.Ay,{container:!0,spacing:2,children:[(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"In Group",value:w.inGroup||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"P&L",value:w.pnl||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"POS",value:(null===w||void 0===w||null===(r=w.position)||void 0===r?void 0:r.length)||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"Orders",value:(null===w||void 0===w||null===(t=w.orders)||void 0===t?void 0:t.total)||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"Pending",value:(null===w||void 0===w||null===(A=w.orders)||void 0===A?void 0:A.pending)||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"Complete",value:(null===w||void 0===w||null===(j=w.orders)||void 0===j?void 0:j.complete)||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"Reject",value:(null===w||void 0===w||null===(f=w.orders)||void 0===f?void 0:f.rejected)||0})}),(0,g.jsx)(u.Ay,{item:!0,xs:3,children:(0,g.jsx)(b,{label:"Cancel",value:(null===w||void 0===w||null===(C=w.orders)||void 0===C?void 0:C.cancelled)||0})})]})]})}}}]);
//# sourceMappingURL=695.d700479f.chunk.js.map